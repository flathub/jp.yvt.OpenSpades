{
    "app-id": "jp.yvt.OpenSpades",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "21.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "openspades",
    "rename-desktop-file": "openspades.desktop",
    "rename-icon": "openspades",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--socket=wayland",
        "--share=network",
        "--device=dri",
        "--extension=org.freedesktop.Platform.GL=directory=lib/GL",
        "--persist=.local/share/openspades"
    ],
    "cleanup": [
        "/include",
        "/lib/pkgconfig"
    ],
    "modules": [
        "shared-modules/glew/glew.json",
        {
            "name": "imagemagick",
            "cleanup": [
                "/bin",
                "/etc",
                "/share",
                "/lib"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.imagemagick.org/ImageMagick/download/releases/ImageMagick-7.1.0-8.tar.xz",
                    "sha256": "393280a93396cbb10f4a88e4dafaa03b0bc8031a86d92fb80948f814fc5d0c01"
                }
            ]
        },
        {
            "name": "openspades",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DOPENSPADES_INSTALL_BINARY=bin",
                "-DOPENSPADES_RESDIR=/app/extra/Resources/",
                "-DCMAKE_CXX_FLAGS=-DGLEW_NO_GLU",
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo"
            ],
            "post-install": [
                "install -Dm0644 jp.yvt.OpenSpades.appdata.xml /app/share/appdata/jp.yvt.OpenSpades.appdata.xml",
                "install -D apply_extra /app/bin/apply_extra"
            ],
            "sources": [
                {
                    "type": "script",
                    "dest-filename": "apply_extra",
                    "commands": [
                        "unzip -q nonfree-paks.zip",
                        "rm nonfree-paks.zip",
                        "mkdir Resources",
                        "mv Nonfree/* ./Resources",
                        "mv OfficialMods/* ./Resources",
                        "rmdir Nonfree OfficialMods"
                    ]
                },
                {
                    "type": "archive",
                    "url": "https://github.com/yvt/openspades/archive/v0.1.3.tar.gz",
                    "sha256": "ecd7aaf568f80712d981ecdd7bf9e380221dc2c16e86d2e56a0ddda87432bea3"
                },
                {
                    "type": "patch",
                    "path": "disable-nonfree-download.patch"
                },
                {
                    "type": "file",
                    "path": "jp.yvt.OpenSpades.appdata.xml"
                },
                {
                    "type": "extra-data",
                    "filename": "nonfree-paks.zip",
                    "url": "https://github.com/yvt/openspades-paks/releases/download/r33/OpenSpadesDevPackage-r33.zip",
                    "sha256": "0927dc323a0b3aba0ee8d1d68d6b544b00fe654740fead6d1faad37aac77a2ad",
                    "size": 4036321
                }
            ]
        }
    ]
}
